---
name: security
description: Enforces mandatory security guidelines for Hyphae POS. Covers PIN hashing, Input Validation, API Security, and RBAC. Use this skill when implementing authentication, handling payments, or designing data flows.
---

# Security Officer (Hyphae POS Edition)

This skill mandates security practices for the Point-of-Sale environment.

## 1. Authentication & Identity

### Staff PINs
- **NEVER** store PINs in plain text (mock data excepted only during Phase 0).
- **MUST** use hashing (Web Crypto API or bcrypt.js) before storage/comparison.
- **Rule:** PINs are 4-6 digits.
- **Lockout:** Enforce max 3 failed attempts per 5 minutes.

### Sessions
- **Timeout:** Auto-logout after 15 minutes of inactivity (configurable).
- **Persistence:** Use secure, HTTP-only cookies or encrypted local storage for session tokens.

## 2. Input Validation (Zod)

All inputs entering the system must be validated with Zod schemas.

```typescript
import { z } from 'zod';

export const PaymentSchema = z.object({
  amount: z.number().positive().finite(),
  method: z.enum(['Cash', 'Card', 'Split']),
  currency: z.literal('USD'),
  terminalId: z.string().uuid()
});
```

- **Sanitization:** Strip HTML/Script tags from user notes/names.
- **Type Safety:** Infer TypeScript types directly from Zod schemas.

## 3. Data Protection

### Scope: Client-Side
- **Class Critical:** Payment Card Numbers (PANs).
  - **NEVER** touch, store, or log PANs in the React app.
  - Rely entirely on Payment Terminal SDKs (Stripe, Square) to handle PANs.
- **Class Sensitive:** Staff PII, Customer Phone Numbers.
  - Encrypt at rest in IndexedDB if storing locally.

### Scope: Transit
- **Force HTTPS:** All API communication must be encrypted.
- **Request Signing:** Critical mutations (Refunds, Voids) should include a request signature (HMAC) generated by the terminal secret.

## 4. Authorization (RBAC)

Enforce strict Role-Based Access Control.

| Role | Permissions |
|------|-------------|
| **Kitchen** | `VIEW_ORDERS`, `UPDATE_STATUS` |
| **Cashier** | `CREATE_ORDER`, `TAKE_PAYMENT` |
| **Manager** | `VOID_ORDER`, `REFUND`, `MANAGE_STAFF` |

**Implementation:**
Use a centralized `PermisionGate` component in React:

```tsx
<PermissionGate required="VOID_ORDER">
  <Button onClick={handleVoid}>Void Item</Button>
</PermissionGate>
```
